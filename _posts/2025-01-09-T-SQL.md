---
title: T-SQL справочник
date: 2025-01-09 18:39:34 +0100
categories: [sql]
tags: [t-sql]
---

Когда  пишу этот пост, уже велика вероятность, что в ближайшее время интересоваться T-SQL не буду. Почти. У меня на повестке дня на самом деле `aspire` и `opentelemetry`. Но сейчас потребовалось, так случилось. 

Словарный запас у меня есть, практики несколько лет,  потом еще готовился  к `assessment`,  но постепенно запас из активного превратился в пассивный, если долго не пользоваться блекнет вовсе. Нужно быстро качественно восстановиться и актуализировать запасец. У меня уже  так случалось. Уперся в фичу, потестировал, не дошло, нашел классную статью, дошло таки, но не закомментировал идею, не резюмировал понятое.Через год наталкиваюсь на это же,  и ни бум-бум, значит нужно опять искать статью и т.д. Естественно, хочется чтобы такого не происходило. 
 
Вспомнил сюжет.  

Что нам говорила Като Ломб,  знавшая уйму языков. Аналогия уместна.  

**Выдержка из книги "Как я изучаю языки"**  
Вопрос первый: можно ли знать шестнадцать языков?    
Ответ: нет, нельзя. По крайней мере нельзя их знать на одинаковом уровне. Родной язык у  
меня только один – венгерский. Но пять языков живет во мне одновременно: русский,  
английский, французский, немецкий и венгерский. Работая с этими языками, я перевожу с  
одного на другой в любом сочетании и в перевод «включаюсь» мгновенно. Прежде чем  
приступить к работе, связанной с применением итальянского, испанского, японского,  
китайского или польского языка, я, чтобы освежить знания, обычно трачу полдня,  
просматривая свои записи. С остальными шестью языками я работаю только как переводчик  
художественной и специальной литературы, то есть имею здесь лишь пассивную практику.  

Я это к тому что время "освежить знание" потребуется. Пара дней. 
Вопрос как должны выглядеть эти "свои записи", для T-SQL в данном случае.  

- Обычно начинают со словаря. Делаем или ищем  словарь.
	Список зарезервированных слов имеется, можно просмотреть его и сделать к нему комментарии. 
	<https://learn.microsoft.com/en-us/sql/t-sql/language-elements/reserved-keywords-transact-sql?view=sql-server-ver16> 

	Я так  делал, не понравилось.
	Список keywords не полный. Например, с моей точки зрения в `EXECUTE AS LOGIN` Login ключевое слово. Но его в списке нет.
	Меня функции интересуют, metadata, не только keywords, есть слова, которые относятся к тематике, которую я бы хотел исключить из рассмотрения.  
	И много времени тратится на подбор примеров.

- Где держать словарь. 
	Подумывал создать database -  таблицу зарезервированных слов,  пояснения и таблица с примерами к нему. Несложно и в VS и Rider есть прекрасные возможности для работы с базой данных. Но использованиеБД утяжеляет процесс,появляется лишняя зависимость, легкости хочется, черновичка, зачем огород городить.  

Варианты  

1. Можно читать свой код,  старые db, учебные. Как справочник не пойдет, много повторов одних и тех же функций, упор на  DDD, то есть тематики разработки, а не на языковые особенности. 
2. Можно читать книги, листинги к ним в особенности, например  `Exam Ref 70-761. Querying Data with Transact-SQL  Ben-Gan.`  

	Минус  в том, что книги - не энциклопедии,  и версии устаревают, год издания с "бородой" и т.д.Книжки могут быть полезны поверх базовой структуры, как дополнение, но не как основа. Матрица должна быть полная, после этого заполняются ячейки.
  
3. Читать reference от А до Я   

  Можно, но слишком много слов,  кода мало и он разбросан по нескольким снипетам. Зачастую я сразу из html страницы копирую снипет в IDE, запускаю,  сохраняю, как пример, и так получается некий набор скриптов, что совершенно нормально,но нет ощущения универсальности. И копировать муторно на самом деле.  

4. Можно просмотреть функции в SSMS в дереве объектов и вспомнить их смысл.

 Я так тоже делал. Но тут проблема еще в том что тест к функции придется самому писать. Добавлять параметры и так далее. Это долго. "Пускай работает железная пила." Еще нужно учитывать что каталоги в SSMS и в reference могут не совпадать. Для `graph` и `logic` каталогов в SSMS 2019 нет вообще. `OpenQuery`  в  reference входит в группу Relation operators, а в SSMS это считается `Rowset functions`. Хотя это, в общем, мелочи.  

Итого. Хотелось бы иметь в одном или нескольких текстовых файлаx весь спектр примеров sql. Листинг, но чтобы это был полный и актуальный справочник.  

Тут я пришел к идее попробовать выгрузить снипеты из markdown.  Привык смотреть репо. Получилось хорошо. Понравилось.   

<script src="https://gist.github.com/KosarevDmitry/b64f73a4824b280db2d80652463361e9.js"></script>

Этим скриптом получил код, готовый к исполнению, остается только открыть файл в  SSMS.   

Просматриваю и выполняю код без копипаста,  только `select and execute`, если нужны комментарии, обращаюсь к reference. У каждого блока есть ссылка `--string-split-transact-sql.md line: 143`, где название файла без расширения совпадает с названием страницы в `url` `https://learn.microsoft.com/en-us/sql/t-sql/` плюс раздел `language-elements/` и название.

Возможно после просмотра кода, захочется добавить краткий комментарий. Тут сложно что-то посоветовать, краткость - сестра таланта и мачеха гонорара, поэтому комментарий может оказаться бесполезным, у меня зачастую не получается, то есть написать достаточно кратко, но чтобы "цепляло", но обычно как-то выразить идею  хочется. Я добавлял  комменты, начиная с `--!`. Подсветка в коде работает, можно смотреть и в `notepad++`.  

Могут быть ошибки отображения когда весь код становится  красным. Из-за незакрытых кавычек, например,  в фамилии D'Hers французского происхождения. Безусловно, была "пустая порода", либо очевидные для меня вещи, которые не интересны.Поэтому я оставлял комментарии к тому, что интересует и потом "выйду" на записи, сделав проходку скриптом по строкам, отмеченными моими комментариями, или воспользуюсь поиском в IDE или Notepad++.

![Desktop View](/assets/search_notepad++.jpg){: width="972" height="589" }

После просмотра такого листинга я уже буду прилично знать материал. По моему, получилось очень удачно. Хотелось бы иметь в своей "оперативной памяти" информацию о том какие опции, в принципе, существуют. В полуготовом варианте, в состоянии "я это уже видел, пойду поищу". Когда же не знаешь о существовании опции, "хороший" код написать проблематичнее. Поэтому полный и актуальный справочник необходим, вопрос только в формате и чтобы без копипастов.
 